<!DOCTYPE html>
<html lang="es">
<head>
  <script>
    // Traducciones para el menú lateral
    const menuTranslations = {
      es: { plantilla: 'Plantilla', once: 'Crear once' },
      eu: { plantilla: 'Taldea', once: 'Hamaikakoa sortu'}
    };
    let menuLang = 'es';
    // Leer idioma guardado en localStorage si existe
    if (localStorage.getItem('lang')) {
      menuLang = localStorage.getItem('lang');
    }
    function updateMenuLang() {
      document.getElementById('menu-once').textContent = menuTranslations[menuLang].once;
      document.getElementById('menu-plantilla').textContent = menuTranslations[menuLang].plantilla;
      document.getElementById('langBtn').textContent = menuLang === 'es' ? 'Eus' : 'Cast';
    }
    document.addEventListener('DOMContentLoaded', updateMenuLang);
    // También actualizar menú al cambiar idioma, asegurando que el botón existe
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('langBtn').addEventListener('click', function() {
        menuLang = menuLang === 'es' ? 'eu' : 'es';
        localStorage.setItem('lang', menuLang); // Guardar idioma
        updateMenuLang();
      });
    });
  </script>
  <meta charset="UTF-8">
  <title>Real Sociedad</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 210px;
      height: 100vh;
      background: #002244;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding-top: 48px;
      z-index: 100;
      box-shadow: 2px 0 12px rgba(0,0,0,0.08);
    }
    .sidebar a {
      color: #fff;
      text-decoration: none;
      font-size: 1.2em;
      font-weight: bold;
      padding: 16px 32px;
      width: 100%;
      display: block;
      border-left: 4px solid transparent;
      transition: background 0.15s, border-color 0.15s;
    }
    .sidebar a.active, .sidebar a:hover {
      background: #003366;
      border-left: 4px solid #0077cc;
    }
    .main-content {
      margin-left: 210px;
      padding: 0;
    }
    @media (max-width: 900px) {
      .sidebar { width: 56px; padding-top: 24px; }
      .sidebar a { font-size: 1em; padding: 12px 8px; }
      .main-content { margin-left: 56px; }
    }
  </style>
  <style>
  body { font-family: Arial, sans-serif; background: #003366; margin: 0; padding: 0; }
    .field-container {
      position: relative;
      width: 650px;
      height: 764px;
      margin: 40px auto 16px auto;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.18);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .field-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  position: relative;
  z-index: 1;
    }
    .player-pos {
      position: absolute;
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 2;
      transition: box-shadow 0.2s, width 0.2s, height 0.2s;
    }
    .player-pos.selected {
      width: 130px;
      height: 130px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.22);
    }
    .player-pos:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.22);
    }
    .player-img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  background: #eee;
  border: 2px solid #0077cc;
    }
    .plus-icon {
      font-size: 3em;
      color: #0077cc;
      font-weight: bold;
      user-select: none;
    }
    .player-list-modal {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .player-list-box {
      background: #fff;
      border-radius: 16px;
      padding: 32px 24px;
      max-width: 420px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 2px 16px rgba(0,0,0,0.18);
    }
    .player-list-box h3 { margin-top: 0; }
    .player-list-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background 0.15s;
    }
    .player-list-item:hover {
      background: #f0f8ff;
    }
    .player-list-img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      background: #eee;
      border: 1px solid #0077cc;
    }
    .player-list-name {
      font-size: 1.1em;
      font-weight: bold;
      color: #222;
    }
    .player-list-dorsal {
      font-size: 1em;
      color: #0077cc;
      font-weight: bold;
      margin-right: 8px;
    }
    .close-modal-btn {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 18px;
      font-size: 1em;
      cursor: pointer;
      margin-top: 18px;
      float: right;
    }
    #optionsBlock {
      width: 100%;
      flex-wrap: wrap;
      gap: 32px;
      margin-top: 32px;
      margin-bottom: 24px;
      text-align: center;
      background: none;
      position: static !important;
      z-index: 2;
      justify-content: center;
    }
    #optionsBlock > div {
      margin-bottom: 20px !important;
      justify-content: center;
    }
    @media (max-width: 700px) {
      #optionsBlock {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 32px;
      }
      #optionsBlock > div {
        margin-bottom: 24px !important;
        justify-content: center;
      }
      .field-container {
    width: 98vw;
    height: 120vw;
    min-width: 0;
    min-height: 0;
    margin: 16px auto 8px auto;
    border-radius: 16px;
  }
  .field-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .player-pos {
    width: 16vw;
    height: 16vw;
    min-width: 60px;
    min-height: 60px;
    max-width: 90px;
    max-height: 90px;
  }
  .player-pos.selected {
    width: 19vw;
    height: 19vw;
    min-width: 70px;
    min-height: 70px;
    max-width: 110px;
    max-height: 110px;
  }
  #optionsContainer {
    display: block;
    margin-top: 24px;
    margin-bottom: 0;
  }
  #filterContainer {
    position: static !important;
    display: block;
    margin: 0 auto 0 auto;
    right: auto !important;
    top: auto !important;
    text-align: center;
    width: 100vw;
    max-width: 100vw;
    z-index: 2;
  }
  #langSwitch {
    right: 8vw !important;
    top: 2vw !important;
  }
  #downloadBtn, #clearBtn {
    min-width: 120px;
    font-size: 1.1em;
    padding: 12px 18px;
  }
  .player-list-box {
    max-width: 96vw;
    padding: 18px 8px;
  }
  .player-list-img {
    width: 36px;
    height: 36px;
  }
}
  </style>
</head>
<body>
  <div class="sidebar">
    <a href="plantilla.html" id="menu-plantilla">Plantilla</a>
    <a href="hamaikakoa.html" id="menu-once" class="active">Crear once</a>
  </div>
  <div class="main-content">
    <div style="position:relative;">
      <div id="langSwitch" style="position:absolute; top:18px; right:24px;">
        <button id="langBtn" style="background:#fff; color:#003366; border-radius:8px; border:none; font-weight:bold; font-size:1em; padding:6px 18px; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.12);">Eus</button>
      </div>
    </div>
    <!-- Opciones: formación, filtro, marca de agua -->
    <div id="optionsBlock" class="d-flex flex-wrap align-items-center justify-content-center gap-4 mb-4" style="margin-top:32px;">
  <div class="d-flex align-items-center flex-wrap justify-content-center" style="margin-bottom:20px;">
    <label id="formationLabel" class="form-label mb-0 me-2" style="color:#fff; font-size:1.2em; font-weight:bold;">
      <span id="formationText">Formación:</span>
    </label>
  <select id="formationSelect" class="form-select w-auto" style="font-size:1em; padding:4px 12px; border-radius:6px; border:none; min-width:110px; max-width:110px;">
  <option value="4-3-3">4-3-3</option>
  <option value="4-2-3-1">4-2-3-1</option>
  <option value="4-4-2 (1)">4-4-2 (1)</option>
  <option value="4-4-2 (2)">4-4-2 (2)</option>
  <option value="5-3-2">5-3-2</option>
    </select>
  </div>
  <div class="d-flex align-items-center flex-wrap justify-content-center" style="margin-bottom:20px;">
    <input type="checkbox" id="filterByPosition" class="form-check-input me-2" style="transform:scale(1.3); vertical-align:middle;">
    <label id="filterLabel" for="filterByPosition" class="form-label mb-0" style="color:#fff; font-size:1.2em; font-weight:bold;">
      <span id="filterText">Filtrar jugadores por posición</span>
    </label>
  </div>
  <div class="d-flex align-items-center flex-wrap justify-content-center" style="margin-bottom:20px;">
    <input type="checkbox" id="watermarkToggle" checked class="form-check-input me-2" style="transform:scale(1.3); vertical-align:middle;">
    <label id="watermarkLabel" for="watermarkToggle" class="form-label mb-0" style="color:#fff; font-size:1.2em; font-weight:bold;">
      <span id="watermarkText">Marca de agua</span>
    </label>
  </div>
</div>
<div class="field-container" style="margin-top:32px;">
  <img class="field-img" src="https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/Zelaia.jpg" alt="Campo">
  <!-- Posiciones de jugadores -->
  <div id="positions"></div>
</div>
<!-- Botones de descargar y limpiar -->
<div style="text-align:center; margin-bottom:32px;">
  <div class="d-flex flex-column flex-md-row justify-content-center align-items-center gap-3">
    <button id="downloadBtn" class="btn btn-primary" style="min-width:170px; font-size:1.4em;">Descargar</button>
    <button id="clearBtn" class="btn btn-primary" style="min-width:170px; font-size:1.4em;">Limpiar</button>
  </div>
</div>
<div id="playerListModal" class="player-list-modal" style="display:none;">
    <div class="player-list-box">
      <h3>Selecciona jugador</h3>
      <div id="playerList"></div>
      <button class="close-modal-btn" onclick="closePlayerList()">Cerrar</button>
    </div>
  </div>
  <script>
    // Traducciones
    const translations = {
      es: {
        filter: 'Filtrar jugadores por posición',
        descargar: 'Descargar',
        limpiar: 'Limpiar',
        seleccionaJugador: 'Selecciona jugador',
        cerrar: 'Cerrar',
        watermark: 'Marca de agua',
        formacion: 'Formación:',
        menuOnce: 'Crear once',
        menuPlantilla: 'Plantilla'
      },
      eu: {
        filter: 'Jokalariak postuarekiko filtratu',
        descargar: 'Jaitsi',
        limpiar: 'Garbitu',
        seleccionaJugador: 'Jokalaria aukeratu',
        cerrar: 'Itxi',
        watermark: 'Ur-marka',
        formacion: 'Formazioa:',
        menuOnce: 'Hamaikakoa sortu',
        menuPlantilla: 'Taldea'
      }
    };
    // Idioma actual
    let currentLang = 'es';
  // Sincronizar idioma principal con menú
  currentLang = menuLang;
    function updateLangBtn() {
      // Actualizar textos según idioma
      document.getElementById('filterText').textContent = translations[currentLang].filter;
      document.getElementById('downloadBtn').textContent = translations[currentLang].descargar;
      document.getElementById('clearBtn').textContent = translations[currentLang].limpiar;
      const modalTitle = document.querySelector('.player-list-box h3');
      if (modalTitle) modalTitle.textContent = translations[currentLang].seleccionaJugador;
      const closeBtn = document.querySelector('.close-modal-btn');
      if (closeBtn) closeBtn.textContent = translations[currentLang].cerrar;
      document.getElementById('watermarkText').textContent = translations[currentLang].watermark;
      document.getElementById('formationText').textContent = translations[currentLang].formacion;
      // Menú lateral
      document.getElementById('menu-once').textContent = translations[currentLang].menuOnce;
      document.getElementById('menu-plantilla').textContent = translations[currentLang].menuPlantilla;
      const btn = document.getElementById('langBtn');
      btn.textContent = currentLang === 'es' ? 'Eus' : 'Cast';
    }
    document.getElementById('langBtn').onclick = function() {
      currentLang = currentLang === 'es' ? 'eu' : 'es';
      updateLangBtn();
      // Aquí podrías añadir lógica para cambiar textos si lo necesitas
    };
    updateLangBtn();
    // Lista de jugadores y posiciones válidas
    const players = [
  { dorsal: 1, name: 'A. Remiro', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/alex_remiro.jpg', positions: ['POR'] },
  { dorsal: 2, name: 'Aramburu', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/jon_mikel_aramburu.jpg', positions: ['LI','LD'] },
  { dorsal: 3, name: 'Aihen', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/aihen_munoz.jpg', positions: ['LD','LI'] },
  { dorsal: 4, name: 'Gorrotxa', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/jon_gorrotxategi.jpg', positions: ['MCD','MC'] },
  { dorsal: 5, name: 'Zubeldia', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/igor_zubeldia.jpg', positions: ['DFC'] },
  { dorsal: 6, name: 'Aritz', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/aritz_elustondo.jpg', positions: ['DFC','LD'] },
  { dorsal: 7, name: 'Barrene', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/ander_barrenetxea.jpg', positions: ['EI','ED'] },
  { dorsal: 8, name: 'Turrientes', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/benat_turrientes.jpg', positions: ['MC','MCD','MCO'] },
  { dorsal: 9, name: 'Óskarsson', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/orri_oskarsson.jpg', positions: ['DC'] },
  { dorsal: 10, name: 'Oyarzabal', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/mikel_oyarzabal.jpg', positions: ['MCO','DC','EI','ED'] },
  { dorsal: 11, name: 'Guedes', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/goncalo_guedes.jpg', positions: ['EI','ED','DC'] },
  { dorsal: 13, name: 'Marrero', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/unai_marrero.jpg', positions: ['POR'] },
  { dorsal: 14, name: 'Take', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/takefusa_kubo.jpg', positions: ['ED','EI'] },
//  { dorsal: 15, name: 'Urko', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/urko_gonzalez_de_zarate.jpg', positions: ['MCD','MC'] },
  { dorsal: 16, name: 'Ćaleta-Car', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/duje_caletacar.jpg', positions: ['DFC'] },
  { dorsal: 17, name: 'Sergio Gómez', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/sergio_gomez.jpg', positions: ['LD','LI','MC','MCO','EI','ED'] },
  { dorsal: 18, name: 'H. Traoré', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/hamari_traore.jpg', positions: ['LD','LI'] },
  { dorsal: 19, name: 'Karrikaburu', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/jon_karrikaburu.jpg', positions: ['DC'] },
//  { dorsal: 20, name: 'Pacheco', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/jon_pacheco.jpg', positions: ['DFC'] },
  { dorsal: 21, name: 'Zakharyan', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/arsen_zakharyan.jpg', positions: ['MCO','EI','ED'] },
  { dorsal: 22, name: 'Goti', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/mikel_goti.jpg', positions: ['MCO','MC','EI','ED'] },
  { dorsal: 23, name: 'Brais Méndez', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/brais_mendez.jpg', positions: ['MC','MCO'] },
  { dorsal: 24, name: 'Sučić', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/luka_sucic.jpg', positions: ['MC','MCO'] },
  { dorsal: 28, name: 'Marín', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/pablo_marin.jpg', positions: ['MC','MCO'] },
  { dorsal: 31, name: 'Jon Martín', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/jon_martin.jpg', positions: ['DFC'] },
  { dorsal: 33, name: 'Rupérez', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/inaki_ruperez.jpg', positions: ['LD','LI','ED'] },
  { dorsal: 40, name: 'Mariezkurrena', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/arkaitz_mariezkurrena.jpg', positions: ['DC','ED','EI','MCO'] },
  { dorsal: '', name: 'Odriozola', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/alvaro_odriozola.jpg', positions: ['LI','LD','ED'] },
  { dorsal: '', name: 'Javi López', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/javi_lopez.jpg', positions: ['LD','LI'] },
  { dorsal: '', name: 'Sadiq', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/sadiq_umar.jpg', positions: ['DC'] },
  { dorsal: '', name: 'Becker', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/sheraldo_becker.jpg', positions: ['EI','ED','DC'] },
  { dorsal: '', name: 'Coming soon...', img: 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/carlos_soler.jpg', positions: ['MC','MCD','MCO'], disabled: true }
    ];

    // Posiciones en el campo (formación 4-3-3)
    // Definición de formaciones
    const formations = {
      '4-3-3': [
        { x: 60, y: 60, role: 'EI' }, // Extremo Izq
        { x: 260, y: 20, role: 'DC' }, // Delantero Centro
        { x: 460, y: 60, role: 'ED' }, // Extremo Der
        { x: 360, y: 190, role: 'MCO' }, // Mediopunta der
        { x: 160, y: 210, role: 'MC' }, // Mediocentro izq
        { x: 260, y: 310, role: 'MCD' }, // Pivote
        { x: 180, y: 470, role: 'DFC' }, // Central Izq
        { x: 340, y: 470, role: 'DFC' }, // Central Der
        { x: 35, y: 420, role: 'LI' }, // Lateral Izq
        { x: 485, y: 420, role: 'LD' }, // Lateral Der
        { x: 260, y: 600, role: 'POR' }
      ],
      '4-2-3-1': [
        { x: 60, y: 100, role: 'EI' }, // Extremo Izq
        { x: 260, y: 20, role: 'DC' }, // Delantero Centro
        { x: 460, y: 100, role: 'ED' }, // Extremo Der
        { x: 260, y: 190, role: 'MCO' }, // Mediopunta
        { x: 160, y: 310, role: 'MCD' }, // Pivote izq
        { x: 360, y: 310, role: 'MCD' }, // Pivote der
        { x: 180, y: 470, role: 'DFC' }, // Central Izq
        { x: 340, y: 470, role: 'DFC' }, // Central Der
        { x: 35, y: 420, role: 'LI' }, // Lateral Izq
        { x: 485, y: 420, role: 'LD' }, // Lateral Der
        { x: 260, y: 600, role: 'POR' }
      ],
      '4-4-2 (1)': [
        { x: 160, y: 40, role: 'DC' }, // Delantero Izq
        { x: 360, y: 40, role: 'DC' }, // Delantero Der
        { x: 420, y: 190, role: 'MCO' }, // Mediopunta der
        { x: 100, y: 190, role: 'MC' }, // Mediocentro izq
        { x: 190, y: 310, role: 'MCD' }, // Pivote izq
        { x: 330, y: 310, role: 'MCD' }, // Pivote der
        { x: 180, y: 470, role: 'DFC' }, // Central Izq
        { x: 340, y: 470, role: 'DFC' }, // Central Der
        { x: 35, y: 420, role: 'LI' }, // Lateral Izq
        { x: 485, y: 420, role: 'LD' }, // Lateral Der
        { x: 260, y: 600, role: 'POR' }
      ],
      '4-4-2 (2)': [
        { x: 160, y: 40, role: 'DC' }, // Delantero Izq
        { x: 360, y: 40, role: 'DC' }, // Delantero Der
        { x: 260, y: 160, role: 'MCO' }, // Mediopunta
        { x: 100, y: 220, role: 'MC' }, // MC izq
        { x: 420, y: 220, role: 'MC' }, // MC der
        { x: 260, y: 320, role: 'MCD' }, // Pivote
        { x: 180, y: 470, role: 'DFC' }, // Central Izq
        { x: 340, y: 470, role: 'DFC' }, // Central Der
        { x: 35, y: 420, role: 'LI' }, // Lateral Izq
        { x: 485, y: 420, role: 'LD' }, // Lateral Der
        { x: 260, y: 600, role: 'POR' }
      ],
      '5-3-2': [
        { x: 160, y: 40, role: 'DC' }, // Delantero Izq
        { x: 360, y: 40, role: 'DC' }, // Delantero Der
        { x: 360, y: 180, role: 'MCO' }, // Mediopunta der
        { x: 160, y: 200, role: 'MC' }, // Mediocentro izq
        { x: 260, y: 300, role: 'MCD' }, // Pivote
        { x: 140, y: 490, role: 'DFC' }, // Central Izq
        { x: 260, y: 440, role: 'DFC' }, // Central
        { x: 380, y: 490, role: 'DFC' }, // Central Der
        { x: 35, y: 390, role: 'LI' }, // Lateral Izq (más adelantado)
        { x: 485, y: 390, role: 'LD' }, // Lateral Der (más adelantado)
        { x: 260, y: 600, role: 'POR' }
      ]
    };

  // Inicializar formación según el selector
  let currentFormation = document.getElementById('formationSelect').value || '4-3-3';
  let positions = formations[currentFormation];

    // Estado de jugadores asignados
    let assigned = Array(positions.length).fill(null);

    // Cambiar formación y mantener jugadores
    document.getElementById('formationSelect').addEventListener('change', function() {
      const prevFormation = currentFormation;
      const newFormation = this.value;
      if (newFormation === prevFormation) return;
      // Mapear roles equivalentes
      const prevPositions = formations[prevFormation];
      const nextPositions = formations[newFormation];
      let newAssigned = Array(nextPositions.length).fill(null);

      newAssigned[0] = assigned[0];
      newAssigned[1] = assigned[1];
      newAssigned[2] = assigned[2];
      newAssigned[3] = assigned[3];
      newAssigned[4] = assigned[4];
      newAssigned[5] = assigned[5];
      newAssigned[6] = assigned[6];
      newAssigned[7] = assigned[7];
      newAssigned[8] = assigned[8];
      newAssigned[9] = assigned[9];
      newAssigned[10] = assigned[10];
  currentFormation = newFormation;
  positions = formations[currentFormation];
  assigned = newAssigned;
  renderPositions();
    });

    function renderPositions() {
      const container = document.getElementById('positions');
      container.innerHTML = '';
      positions.forEach((pos, idx) => {
        const div = document.createElement('div');
        div.className = 'player-pos' + (assigned[idx] ? ' selected' : '');
        div.style.left = pos.x + 'px';
        div.style.top = pos.y + 'px';
        div.onclick = (e) => {
          e.stopPropagation();
          openPlayerList(idx);
        };
        if (assigned[idx]) {
          div.innerHTML = '<img class="player-img" src="' + assigned[idx].img + '" title="' + assigned[idx].name + ' (' + assigned[idx].dorsal + ')" />';
        } else {
          div.innerHTML = '<span class="plus-icon">+</span>';
        }
        container.appendChild(div);
      });
    }

    function openPlayerList(idx) {
      const modal = document.getElementById('playerListModal');
      modal.style.display = 'flex';
      const list = document.getElementById('playerList');
      list.innerHTML = '';
      // Actualizar título y botón cerrar según idioma
      const modalTitle = document.querySelector('.player-list-box h3');
      if (modalTitle) modalTitle.textContent = translations[currentLang].seleccionaJugador;
      const closeBtn = document.querySelector('.close-modal-btn');
      if (closeBtn) closeBtn.textContent = translations[currentLang].cerrar;
      const filterActive = document.getElementById('filterByPosition').checked;
      const posRole = positions[idx].role;
      players.forEach(player => {
        if (filterActive && (!player.positions || !player.positions.includes(posRole))) return;
        const item = document.createElement('div');
        item.className = 'player-list-item';
        let imgTag = '<img class="player-list-img" src="' + player.img + '" />';
        if (player.disabled) {
          imgTag = '<img class="player-list-img" src="' + player.img + '" style="filter: grayscale(1); opacity: 0.6;" />';
          item.style.pointerEvents = 'none';
          item.style.opacity = '0.6';
        } else {
          item.onclick = () => {
            // Identificador único: dorsal si existe, si no, nombre
            const getId = p => p ? (p.dorsal ? p.dorsal : p.name) : null;
            const playerId = getId(player);
            const currentIdx = assigned.findIndex(p => getId(p) === playerId);
            if (currentIdx !== -1 && currentIdx !== idx) {
              const temp = assigned[idx];
              assigned[idx] = player;
              assigned[currentIdx] = temp;
            } else {
              assigned[idx] = player;
            }
            modal.style.display = 'none';
            renderPositions();
          };
        }
        item.innerHTML =
          '<span class="player-list-dorsal" style="display:inline-block;min-width:22px;max-width:22px;text-align:right;">' + (player.dorsal ? player.dorsal : '&nbsp;') + '</span>' +
          imgTag +
          '<span class="player-list-name">' + player.name + '</span>';
        list.appendChild(item);
      });
    // Actualizar lista de jugadores al cambiar el filtro
    document.getElementById('filterByPosition').addEventListener('change', () => {
      renderPositions();
    });
      // Cerrar modal al click fuera de la caja
      setTimeout(() => {
        modal.onclick = function(e) {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        };
      }, 50);
    }

    function closePlayerList() {
      document.getElementById('playerListModal').style.display = 'none';
    }

    // Descargar alineación como imagen
    function setupButtons() {
      document.getElementById('downloadBtn').onclick = function() {
        const field = document.querySelector('.field-container');
        if (window.html2canvas) {
          window.html2canvas(field, {
        backgroundColor: null,
        useCORS: true,
        scale: 2 // Mejora la calidad duplicando la resolución
      }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Hamaikakoa.jpg';
            link.href = canvas.toDataURL('image/jpeg', 0.98); // Calidad máxima
            link.click();
          });
        } else {
          alert('html2canvas no está cargado todavía. Espera unos segundos y vuelve a intentarlo.');
        }
      };
      document.getElementById('clearBtn').onclick = function() {
        assigned = Array(positions.length).fill(null);
        renderPositions();
      };
    }
    setupButtons();
    // Cargar html2canvas si no existe
    if (!window.html2canvas) {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
      script.onload = setupButtons;
      document.body.appendChild(script);
    }

    // Al cargar, sincronizar selector y formación
    document.addEventListener('DOMContentLoaded', function() {
      // Si el selector tiene valor, usarlo
      currentFormation = document.getElementById('formationSelect').value || '4-3-3';
      positions = formations[currentFormation];
      renderPositions();
    });
    document.getElementById('watermarkToggle').addEventListener('change', function() {
  const fieldImg = document.querySelector('.field-img');
  if (this.checked) {
    fieldImg.src = 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/Zelaia.jpg';
  } else {
    fieldImg.src = 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/Zelaia2.jpg';
  }
});
    // Duplicar el contenido de opciones para móvil
function renderMobileOptions() {
  const mobile = document.getElementById('optionsContainerMobile');
  mobile.innerHTML = `
    <div id="filterContainerMobileInner">
      <label id="formationLabelMobile" style="color:#fff; font-size:1.2em; font-weight:bold; display:block; margin-bottom:8px;">
        <span id="formationTextMobile">Formación:</span>
        <select id="formationSelectMobile" style="font-size:1em; padding:4px 12px; border-radius:6px; border:none; margin-left:8px;">
          <option value="4-3-3">4-3-3</option>
        </select>
      </label>
      <label id="filterLabelMobile" style="color:#fff; font-size:1.2em; font-weight:bold;">
        <input type="checkbox" id="filterByPositionMobile" style="transform:scale(1.3); margin-right:8px; vertical-align:middle;">
        Filtrar jugadores por posición
      </label>
      <br>
      <label id="watermarkLabelMobile" style="color:#fff; font-size:1.2em; font-weight:bold; margin-top:8px; display:inline-block;">
        <input type="checkbox" id="watermarkToggleMobile" checked style="transform:scale(1.3); margin-right:8px; vertical-align:middle;">
        Marca de agua
      </label>
    </div>
  `;
  // Sincronizar valores y eventos
  document.getElementById('formationSelectMobile').value = document.getElementById('formationSelect').value;
  document.getElementById('formationSelectMobile').onchange = function() {
    document.getElementById('formationSelect').value = this.value;
  };
  document.getElementById('filterByPositionMobile').checked = document.getElementById('filterByPosition').checked;
  document.getElementById('filterByPositionMobile').onchange = function() {
    document.getElementById('filterByPosition').checked = this.checked;
    renderPositions();
  };
  document.getElementById('watermarkToggleMobile').checked = document.getElementById('watermarkToggle').checked;
  document.getElementById('watermarkToggleMobile').onchange = function() {
    document.getElementById('watermarkToggle').checked = this.checked;
    const fieldImg = document.querySelector('.field-img');
    if (this.checked) {
      fieldImg.src = 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/Zelaia.jpg';
    } else {
      fieldImg.src = 'https://raw.githubusercontent.com/OriyokoIjitua/TwReal/main/img/Zelaia2.jpg';
    }
  };
}
// Detectar si es móvil y renderizar opciones
function checkMobileOptions() {
  if (window.innerWidth <= 700) {
    renderMobileOptions();
  }
}
window.addEventListener('resize', checkMobileOptions);
document.addEventListener('DOMContentLoaded', checkMobileOptions);
    // Actualizar traducciones en móvil
    function updateLangBtn() {
  document.getElementById('filterText').textContent = translations[currentLang].filter;
  document.getElementById('downloadBtn').textContent = translations[currentLang].descargar;
  document.getElementById('clearBtn').textContent = translations[currentLang].limpiar;
  const modalTitle = document.querySelector('.player-list-box h3');
  if (modalTitle) modalTitle.textContent = translations[currentLang].seleccionaJugador;
  const closeBtn = document.querySelector('.close-modal-btn');
  if (closeBtn) closeBtn.textContent = translations[currentLang].cerrar;
  document.getElementById('watermarkText').textContent = translations[currentLang].watermark;
  document.getElementById('formationText').textContent = translations[currentLang].formacion;
  document.getElementById('menu-once').textContent = menuTranslations[menuLang].once;
  document.getElementById('menu-plantilla').textContent = menuTranslations[menuLang].plantilla;
  const btn = document.getElementById('langBtn');
  btn.textContent = currentLang === 'es' ? 'Eus' : 'Cast';
  // Móvil
  if (document.getElementById('filterLabelMobile'))
    document.getElementById('filterLabelMobile').childNodes[2].textContent = translations[currentLang].filter;
  if (document.getElementById('watermarkLabelMobile'))
    document.getElementById('watermarkLabelMobile').childNodes[2].textContent = translations[currentLang].watermark;
  if (document.getElementById('formationTextMobile'))
    document.getElementById('formationTextMobile').textContent = translations[currentLang].formacion;
}
  </script>
</body>
</html>
